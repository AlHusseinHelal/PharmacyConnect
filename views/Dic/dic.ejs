<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DIC Reciever</title>
  <!-- LINK FAVICON -->
  <link rel="shortcut icon" href="/svg/ConnectLogo.svg" type="image/x-icon" />


  <!-- FONTAWESOME -->
  <link href="../fontawesome/css/fontawesome.css" rel="stylesheet" />
  <link href="../fontawesome/css/brands.css" rel="stylesheet" />
  <link href="../fontawesome/css/solid.css" rel="stylesheet" />
  <!-- BOOTSTRAP ICON -->
  <link href="../css/bootstrap-icons.css" rel="stylesheet" />
  <!-- BOOTSTRAP CSS -->
  <link href="../css/bootstrap.min.css" rel="stylesheet" />
  <!-- HEADER CSS -->
  <link rel="stylesheet" href="../css/style.css" />
  <!-- MY STYLE CSS -->
  <link rel="stylesheet" href="../css/dic/dic.css">
</head>

<body>
  <!-- HEADER -->
  <%- include("../partials/header.ejs") %>
    <!-- LIGHT ICON -->
    <%- include("../partials/lighticon.ejs") %>
      <svg style="display: none">
        <symbol id="home" viewBox="0 0 16 16">
          <path
            d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z" />
        </symbol>
        <symbol id="table" viewBox="0 0 16 16">
          <path
            d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z" />
        </symbol>
        <symbol id="people-circle" viewBox="0 0 16 16">
          <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
          <path fill-rule="evenodd"
            d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
        </symbol>
      </svg>



      <main class="container m-0  " style="width: 100%; max-width: unset; height: 90%; ">
        <div class="d-flex flex-column flex-md-row h-100 p-3 row justify-content-md-around">

          <div class="mh-100 col-md-4 p-2 overflow-y-auto">

            <article class="overflow-y-auto">
              <ul class="accordion ">
                <li class="accordion__item ">
                  <a href="#" class="accordion__link d-flex"><img class="me-2" src="../svg/addmed-14.svg" width="18"
                      alt="">Add New Medication</a>
                  <ul class="sub-accordion">
                    <li class="sub-accordion__item ">
                      
                        <div class="d-flex flex-column">
                          <input placeholder="Generic Name" class="input mb-2" name="generic" id="generic" type="text" />
                          <input placeholder="Trade Name" class="input mb-2" name="trade" id="trade" type="text" />
                          <input placeholder="Med Code" class="input mb-2" name="code" id="code" type="text" />
                          
                          <div id="invalidcode" class=" d-flex flex-row align-items-center my-2 d-none"
                            style="border: 1px solid #000509; border-left: 3px solid red; border-radius: 5px;">
                            <img class="ms-1" src="/svg/alertsign-02.svg" height="20vh" alt="">
                            <p class="my-1 ms-1">This Code Is Already Exist</p>
                          </div>
                          
                          <div class="d-flex justify-content-between align-items-center">
                          
                            <select placeholder="Class" class="input" name="classname" id="clas" type="text" style="width: 75%;">
                              <option disabled hidden selected>Select...</option>
                              <% medclass.forEach(item=> { %>
                                <option value="<%= item.classname %>">
                                  <%= item.classname %>
                                </option>
                                <% }) %>
                            </select>
                            <div class="uiverse mb-2" data-bs-toggle="modal" data-bs-target="#exampleModal"
                              style="width: 20%; margin: unset;">
                              <span class="tooltip">Add Class</span>
                              <span>
                                ADD
                              </span>
                            </div>
                          </div>
                          <!-- <input placeholder="Class" class="input mb-2" name="class" type="text" /> -->
                          <textarea placeholder="Mechanism" class="input mb-2" name="mechanism" id="mechanism" type="text" cols="30"
                            rows="10"></textarea>
                          <input placeholder="Dosage Form" class="input mb-2" name="dosageform" id="dosageform" type="text" />
                          <textarea placeholder="Dose" class="input mb-2" name="dose" id="dose" type="text" cols="30"
                            rows="10"></textarea>
                          <textarea placeholder="Administration" class="input mb-2" name="administration" id="administration" type="text"
                            cols="30" rows="10"></textarea>
                          <textarea placeholder="Patient Information" class="input mb-2" name="ptinformation" id="ptinformation" type="text"
                            cols="30" rows="10"></textarea>
                          <textarea placeholder="Side Effects" class="input mb-2" name="sideeffect" id="sideeffect" type="text" cols="30"
                            rows="10"></textarea>
                          <textarea placeholder="Monitor" class="input mb-2" name="monitor" id="monitor" type="text" cols="30"
                            rows="10"></textarea>
                          <textarea placeholder="Interaction" class="input mb-2" name="interaction" id="interaction" type="text" cols="30"
                            rows="10"></textarea>
                          <textarea placeholder="Interaction" class="input mb-2" name="specialprecaution" id="specialprecaution" type="text"
                            cols="30" rows="10"></textarea>
                            <textarea placeholder="Toxicity" class="input mb-2" name="toxicity" id="toxicity" type="text"
                            cols="30" rows="10"></textarea>
                          <textarea placeholder="Miscellaneous" class="input mb-2" name="miscellaneous" id="miscellaneous" type="text"
                            cols="30" rows="10"></textarea>
                            <form id="addmedication" class="d-flex flex-column">
                          <button  type="submit" style="width:130px;">
                            Submit
                            <div class="arrow-wrapper">
                              <div class="arrow"></div>
                            </div>
                          </button>
                          <form>
                        </div>
                    </li>

                  </ul>
                </li>

                <!-- Moda addmedicationclass -->
                <div class="connectmodal modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                  aria-hidden="true">
                  <div class="glass modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Adding New Class Name</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>

                      <div class="modal-body">
                        <input style="text-transform: capitalize;" placeholder="Class" class="input mb-2 w-100"
                          id="classname" name="classname" type="text" />


                        <div id="noclassname" class=" d-flex flex-row align-items-center my-2 d-none"
                          style="border: 1px solid #dee2e6; border-left: 3px solid red; border-radius: 5px;">
                          <img class="ms-1" src="/svg/alertsign-02.svg" height="20vh" alt="">
                          <p class="my-1 ms-1">Please Enter A Class Name</p>
                        </div>

                        <div id="classnameexist" class=" d-flex flex-row align-items-center my-2 d-none"
                          style="border: 1px solid #dee2e6; border-left: 3px solid red; border-radius: 5px;">
                          <img class="ms-1" src="/svg/alertsign-02.svg" height="20vh" alt="">
                          <p class="my-1 ms-1">This Class Is Already Exist</p>
                        </div>


                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <form id="addmedicationclass">
                          <button type="submit" class="btn btn-primary">Add</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>

                <li class="accordion__item">
                  <a href="#" class="accordion__link d-flex"><img class="me-2" src="../svg/updatemedication-13.svg"
                      width="18" alt="">Update Medication</a>
                  <ul class="sub-accordion">
                    <li class="sub-accordion__item">
                      <form action="/updatemedication?_method=PUT" method="post" class="d-flex flex-column">
                        <select placeholder="Trade Name" class="input mb-2" name="trade" type="text">
                          <option disabled hidden selected>Trade Name ...</option>
                          <% med.forEach(item=> { %>
                            <option value="<%= item.generic %>">
                              <%= item.generic %>
                            </option>
                            <% }) %>
                        </select>

                        <select placeholder="Change" class="input mb-2" name="select" type="text">
                          <option disabled hidden selected>Select....</option>
                          <option value="trade">Trade</option>
                          <option value="origin">Origin</option>
                          <option value="mechanism">Mechanism Of Action</option>
                          <option value="dosageform">Dosage Form</option>
                          <option value="dose">Dose</option>
                          <option value="administration">Administration</option>
                          <option value="ptinformation">Patient Information</option>
                          <option value="sideeffect">Side Effect</option>
                          <option value="monitor">Monitor</option>
                          <option value="interaction">Interaction</option>
                          <option value="specialprecaution">Special Precaution</option>
                          <option value="toxicity">Toxicity</option>
                          <option value="miscellaneous">Miscellaneous</option>
                        </select>

                        <textarea placeholder="" class="input mb-2" name="input" type="text" cols="30"
                          rows="10"></textarea>

                        <button type="submit" style="width:130px;">
                          Submit
                          <div class="arrow-wrapper">
                            <div class="arrow"></div>

                          </div>
                        </button>
                      </form>
                    </li>

                  </ul>
                </li>
              </ul>
              <div class="cardtwo w-100">
              <% if (search.length === 0) { %>
                <h3 class="card__title">Data Search
                </h3>
                <p class="card__content">No Search Data Avaliable. </p>
              <% } %>
              <% if (search.length >= 1) { %>
                <a href="/excel" ><i class="fa-solid fa-arrow-up-from-bracket fa-rotate-90" style="color: #74c0fc;"> </i></a>
                
                <% search.forEach((item, index) => { %>
                  <h3 class="card__title">Question#<%= index+1 %>
                  </h3>
                  <p class="card__content"><%= item.question %> </p>
                  <p class="card__content"><i class="me-1" style="color: blue;">ANSWER:</i><%= item.answer %> </p>
                  <li class=" border-top my-3 notlist" style="list-style: none;"></li>
                <% }) %>
                
              <% } %>
                
              
                
              
              
                
                <div class="card__arrow">
                  <svg type="button" data-bs-toggle="modal" data-bs-target="#exampleModal3"
                     fill="none" viewBox="0 0 24 24" height="15" width="15">
                    <path fill="#fff"
                      d="M13.4697 17.9697C13.1768 18.2626 13.1768 18.7374 13.4697 19.0303C13.7626 19.3232 14.2374 19.3232 14.5303 19.0303L20.3232 13.2374C21.0066 12.554 21.0066 11.446 20.3232 10.7626L14.5303 4.96967C14.2374 4.67678 13.7626 4.67678 13.4697 4.96967C13.1768 5.26256 13.1768 5.73744 13.4697 6.03033L18.6893 11.25H4C3.58579 11.25 3.25 11.5858 3.25 12C3.25 12.4142 3.58579 12.75 4 12.75H18.6893L13.4697 17.9697Z">
                    </path>
                  </svg>
                </div>
              </div>


              <!-- Modal SEARCH DATE -->
              <div class="connectmodal modal fade" id="exampleModal3" tabindex="-1" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="glass modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                      <form action="/findDatedic" method="post">
                        <div class="mb-3">
                          <label for="sDate" class="col-form-label">Start Date</label>
                          <input name="sDate" type="date" class="form-control" id="sDate" />
                        </div>

                        <div class="mb-3">
                          <label for="eDate" class="col-form-label">End Date</label>
                          <input name="eDate" type="date" class="form-control" id="eDate" />
                        </div>

                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Close
                      </button>

                      <button type="submit" class="btn btn-primary">ADD

                      </button>
                      </form>


                    </div>
                  </div>
                </div>
              </div>
            </article>
          </div>

          <div class="mh-100 border col-md-8 rounded-2 p-2 d-flex flex-column align-items-center overflow-y-auto"
            style="box-shadow: 0px 0px 4px 3px rgba(178, 178, 178, 0.6);">
            <% if (dic.length>= 1) { %>
              <% dic.forEach(item=> { %>
                <div class="card mb-1">
                  <div class="card-wrapper">
                    <div class="card-icon d-flex flex-column text-center">
                      <div class="icon-cart-box d-flex justify-content-center align-items-center ">
                        <div >
                          <img style="border-radius: 50%;" width="60" src="<%= item.senderimage %>" alt="">
                        </div>
                      </div>
                      <div class="mt-1">
                        <%= item.sendername%>
                      </div>
                    </div>

                    <div class="card-content ms-2">
                      <div class="card-title-wrapper">
                        <span class="card-title mb-0">Question<span class="ms-1"><i
                              style="font-size:x-small; color: grey;">
                              <%= moment(item.createdAt).format('DD-MM-YYYY hh:mm a') %>
                            </i></span></span>
                      </div>
                      <div class="card-text">
                        <%= item.question %>
                      </div>
                      <button type="button" class="btn-accept mb-2" data-bs-toggle="modal"
                        data-bs-target="#exampleModal<%= item._id %>">Answer<span class="ms-1 <%= item.answer !== ""? "d-block" : "d-none" %>">
                          <i style="font-size:x-small; color: grey;">
                            <%= moment(item.updatedAt).format('DD-MM-YYYY hh:mm a') %>
                          </i></span></span></button>
                      <div class="card-text mb-3">
                        <%= item.answer %>
                      </div>
                    </div>
                  </div>
                </div>


                <!-- Modal dicanswer -->
                <div class="modal fade" id="exampleModal<%= item._id %>" tabindex="-1"
                  aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="connectmodal modal-dialog">
                    <div class="glass modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Answer</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <form action="/dicanswer/<%= item._id %>?_method=PUT" method="post">
                        <div class="modal-body">
                          <textarea class="input w-100" name="answer" id="" cols="30" rows="10"></textarea>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          <button type="submit" class="btn btn-primary">Save changes</button>
                      </form>
                    </div>
                  </div>
                </div>
          </div>
          <% }) %>
            <% } %>



        </div>
        </div>
      </main>



      <!-- LINK TO jQuary -->
      <script src="../js/jquery-3.7.1.min.js"></script>

      <!-- LINK TO BOOTSTRAP.JS -->
      <script src="../js/aos.js"></script>
      <script src="../js/bootstrap.bundle.min.js"></script>
      <script src="../js/glightbox.min.js"></script>
      <script src="../js/isotope.pkgd.min.js"></script>
      <script src="../js/swiper-bundle.min.js"></script>
      <script src="../js/noframework.waypoints.js"></script>
      <script src="../js/validate.js"></script>

      <script src="../js/main.js"></script>

      <!-- FORM SCRIPT -->

      <!-- ACCORDION -->
      <script>
        function slide(link) {
          var down = function (callback, time) {
            var subMenu = link.nextElementSibling;
            var height = subMenu.clientHeight;
            var part = height / 100;

            var paddingTop = parseInt(
              window.getComputedStyle(subMenu, null).getPropertyValue("padding-top")
            );
            var paddingBottom = parseInt(
              window
                .getComputedStyle(subMenu, null)
                .getPropertyValue("padding-bottom")
            );
            var paddingTopPart = parseInt(paddingTop) / 50;
            var paddingBottomPart = parseInt(paddingBottom) / 30;

            (function innerFunc(i, t, b) {
              subMenu.style.height = i + "px";

              i += part;

              if (t < paddingTop) {
                t += paddingTopPart;
                subMenu.style.paddingTop = t + "px";
              } else if (b < paddingBottom) {
                b += paddingBottomPart;
                subMenu.style.paddingBottom = b + "px";
              }

              if (i < height) {
                setTimeout(function () {
                  innerFunc(i, t, b);
                }, time / 100);
              } else {
                subMenu.removeAttribute("style");
                callback();
              }
            })(0, 0, 0);
          },
            up = function (callback, time) {
              var subMenu = link.nextElementSibling;
              var height = subMenu.clientHeight;
              var part = subMenu.clientHeight / 100;
              var paddingTop = parseInt(window.getComputedStyle(subMenu).paddingTop);
              var paddingBottom = parseInt(
                window.getComputedStyle(subMenu).paddingBottom
              );
              var paddingTopPart = parseInt(paddingTop) / 30;
              var paddingBottomPart = parseInt(paddingBottom) / 50;

              (function innerFunc(i, t, b) {
                subMenu.style.height = i + "px";

                i -= part;
                i = i.toFixed(2);

                if (b > 0) {
                  b -= paddingBottomPart;
                  b = b.toFixed(1);
                  subMenu.style.paddingBottom = b + "px";
                } else if (t > 0) {
                  t -= paddingTopPart;
                  t = t.toFixed(1);
                  subMenu.style.paddingTop = t + "px";
                }

                if (i > 0) {
                  setTimeout(function () {
                    innerFunc(i, t, b);
                  }, time / 100);
                } else {
                  subMenu.removeAttribute("style");
                  callback();
                }
              })(height, paddingTop, paddingBottom);
            };

          return {
            down: down,
            up: up
          };
        }

        var accordion = (function () {
          var menu = document.querySelectorAll(".accordion");
          var activeClass = "accordion__link_active";
          var arr = [];
          var timer = 100;

          for (let i = 0; i < menu.length; i++) {
            for (let p = 0; p < menu[i].children.length; p++) {
              var link = menu[i].children[p].firstElementChild;

              if (link.classList.contains(activeClass)) {
                arr[i] = link;
              }
            }
          }

          function accordionInner(i) {
            var clicked = false;

            menu[i].addEventListener("click", function (e) {
              if (e.target.tagName === "A" && !clicked) {
                clicked = true;

                if (e.target.classList.contains(activeClass)) {
                  slide(e.target).up(function () {
                    clicked = false;

                    e.target.classList.remove(activeClass);

                    console.log("slide up of accordion " + i + " is done");
                  }, timer);
                } else {
                  if (arr.length > 0) {
                    slide(arr[i - 1]).up(function () {
                      arr[i - 1].classList.remove(activeClass);

                      arr[i - 1] = e.target;

                      console.log("slide up of accordion " + i + " is done");
                    }, timer);
                  }

                  e.target.classList.add(activeClass);

                  slide(e.target).down(function () {
                    clicked = false;

                    arr[i - 1] = e.target;

                    console.log("slide down of accordion " + i + " is done");
                  }, timer);
                }
              }
            });

            i++;

            if (i < menu.length) {
              accordionInner(i);
            }
          }
          accordionInner(0);
        })();
      </script>

      <!-- ADD MEDICATION CLASS -->
      <script>
        addmedicationclass.addEventListener('click', async (event) => {
          event.preventDefault()
          const res = await fetch("/addmedicationclass", {
            method: "POST",
            body: JSON.stringify({ classname: classname.value }),
            headers: { "Content-Type": "application/json" },
          })
          const data = await res.json()
          if (data.errors) {
            data.errors.forEach(item => {
              if (item.path === "classname") {
                noclassname.classList.remove("d-none")
                classname.classList.add("redframe")
              } else {
                noclassname.classList.add("d-none")
                classname.classList.remove("redframe")
              }
            });
          }

          if (data.unique) {
            classnameexist.classList.remove("d-none")
            classname.classList.add("redframe")
          } else {
            classnameexist.classList.add("d-none")
            classname.classList.remove("redframe")
          }

          if (data.done) {
            location.assign("/dic")
          }

        });

      </script>

      <!-- ADD MEDICATION  -->
      <script>
        addmedication.addEventListener('click', async (event) => {
          event.preventDefault()
          const res = await fetch("/addmedication", {
            method: "POST",
            body: JSON.stringify({ generic: generic.value, trade: trade.value, code: code.value, classname: clas.value, mechanism: mechanism.value, dosageform: dosageform.value, administration: administration.value, ptinformation: ptinformation.value, sideeffect: sideeffect.value, monitor: monitor.value, interaction: interaction.value, specialprecaution: specialprecaution.value, toxicity: toxicity.value, miscellaneous: miscellaneous.value, }),
            headers: { "Content-Type": "application/json" }, 
          })
          const data = await res.json()
          

          if (data.code) {
            invalidcode.classList.remove("d-none")
            code.classList.add("redframe")
          } else {
            invalidcode.classList.add("d-none")
            code.classList.remove("redframe")
          }

          if (data.done) {
            location.assign("/dic")
          }

        });

      </script>


</body>

</html>