<!doctype html>
<html lang="en" data-bs-theme="auto">

<head>


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Hugo 0.118.2">
  <title>PharmacyConnect</title>
  <link rel="shortcut icon" href="../SVG/ConnectLogo.svg" type="image/x-icon">


  <!-- bootstrap CSS -->
  <link href="../CSS/bootstrap.min.css" rel="stylesheet">


  <!-- bootstrap JS -->
  <script defer src="../JS/bootstrap.bundle.min.js"></script>


  <!-- Custom styles for this template -->
  <link href="../CSS/sign-in.css" rel="stylesheet">
</head>

<body class="d-flex align-items-center py-4 bg-body-tertiary">


  <main class="form-signin w-100 m-auto">

    <h1 class="h3 mb-5 fw-normal text-center"
      style="font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;"> Registration</h1>

    <form id="registrationform">

      <div class="form-floating mb-2">
        <input type="text" class="form-control rounded-top-2 " id="firstname" name="firstname" placeholder="User Name"
          required style="border-radius: 0;">
        <label for="firstname">First Name</label>
      </div>

      <div class="form-floating mb-2">
        <input type="text" class="form-control rounded-1 " id="lastname" name="lastname" placeholder="User Name"
          required style="border-radius: 0;">
        <label for="lastname">Last Name</label>
      </div>


      <div class="form-floating">
        <input type="number" class="form-control rounded-1" id="code" name="code" placeholder="Code" required>
        <label for="Code">Code</label>
      </div>

      <div id="codeexist" class=" d-flex flex-row align-items-center mt-2 d-none"
        style="border: 1px solid #dee2e6; border-left: 3px solid red; border-radius: 5px;">
        <img class="ms-1" src="/svg/alertsign-02.svg" height="20vh" alt="">
        <p class="my-1 ms-1">The Code Is Already Existing</p>
      </div>


      <div class="form-floating mt-2 ">
        <input type="text" class="form-control rounded-1" id="email" name="email" placeholder="Email" required>
        <label for="email">Email</label>
      </div>

      <div id="emailexist" class=" d-flex flex-row align-items-center mt-2 d-none"
        style="border: 1px solid #dee2e6; border-left: 3px solid red; border-radius: 5px;">
        <img class="ms-1" src="/svg/alertsign-02.svg" height="20vh" alt="">
        <p class="my-1 ms-1">The Email Is Already Existing</p>
      </div>

      <div id="emailwrong" class=" d-flex flex-row align-items-center mt-2 d-none"
        style="border: 1px solid #dee2e6; border-left: 3px solid red; border-radius: 5px;">
        <img class="ms-1" src="/svg/alertsign-02.svg" height="20vh" alt="">
        <p class="my-1 ms-1">Please enter a valid email</p>
      </div>


      <div class="form-floating mt-2">
        <input type="password" class="form-control rounded-1" id="password" name="password" placeholder="Password"
          required>
        <label for="password">Password</label>
      </div>

      <div id="wrongpassword" class=" d-flex flex-row align-items-center mt-2 d-none"
        style="border: 1px solid #dee2e6; border-left: 3px solid red; border-radius: 5px;">
        <img class="ms-1" src="/svg/alertsign-02.svg" height="20vh" alt="">
        <p class="my-1 ms-1">Password must be at least 8 characters with 1 upper case letter and 1 number</p>
      </div>

      <div class="form-floating">
        <input type="password" class="form-control" id="cpassword" name="cpassword" placeholder="Confirm Password"
          required>
        <label for="lastname">Confirm Password</label>
      </div>




      <button class="btn btn-primary w-100 py-2 mt-2" type="submit" value="register">Sign Up</button>

    </form>


    <p class="mt-5 mb-3 text-body-secondary">&copy; 2023</p>
  </main>

  <script>
    registrationform.addEventListener("submit", async (e) => {
      e.preventDefault();

      const res = await fetch("/adduser", {
        method: "POST",
        body: JSON.stringify({ email: email.value, password: password.value, code: code.value, firstname: firstname.value, lastname: lastname.value }),
        headers: { "Content-Type": "application/json" },
      });

      const data = await res.json();
      if (data.validationerrors) {
        console.log(data.validationerrors)
        data.validationerrors.forEach(item => {
          if (item.path == "email") {
             emailwrong.classList.remove("d-none")
          } else {
            emailwrong.classList.add("d-none")
          }
          if (item.path == "password") {
             wrongpassword.classList.remove("d-none")
          } else {
            wrongpassword.classList.add("d-none")
          }
        });
      }

      if (data.emailexist) {
        console.log(data.emailexist)
         document.getElementById('emailexist').classList.remove("d-none");
      } else {
        document.getElementById('emailexist').classList.add("d-none");
      }

      if (data.codeexist) {
        console.log(data.codeexist)
         document.getElementById('codeexist').classList.remove("d-none");
      } else {
        document.getElementById('codeexist').classList.add("d-none");
      }

      if (data.id) {
      location.assign("/login")  
        
      }
    
      


    });
  </script>


</body>

</html>